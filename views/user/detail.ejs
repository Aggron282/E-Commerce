
<% if(!isAdmin){ %>
<%- include("./../layouts/head.ejs") %>
<%}else{%>
  <head>
    <meta charset="utf-8">
    <title></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://fonts.cdnfonts.com/css/amazon-ember" rel="stylesheet">
    <link href ='./../../../css/main.css' rel="stylesheet"/>
    <link href ='./../../../css/detail.css' rel="stylesheet"/>
    <link href ='./../../../css/main.css' rel="stylesheet"/>
    <link href ='./../../../css/detail.css' rel="stylesheet"/>
    <link href ='./../../../css/review.css' rel="stylesheet"/>
    <link href ='./../../../css/cart.css' rel="stylesheet"/>
    <link href ='./../../../css/search.css' rel="stylesheet"/>
    <link href ='./../../../css/catagory_products.css' rel="stylesheet"/>
    <link href ='./../../../css/admin.css' rel="stylesheet"/>
    <link href = "./../../../css/admin_header.css" rel= "stylesheet"/>
  </head>
<%}%>
<% if(!isAdmin){ %>
  <%- include("./header.ejs") %>
  <div class="overlay_content inactive">
    <%- include("./../layouts/user/home/search_overlay.ejs") %>
  </div>
<%}else{ %>
  <%- include("./../layouts/admin/admin_header.ejs") %>
<%}%>


<main class="main_content relative">
  <% if(isAdmin){ %>
    <%- include("./../layouts/admin/product_form.ejs") %>
  <%}%>

  <div class="row">

    <div class="col-7">

        <div class="product_detail_box">

            <p class="product_detail--name"> <%= item.title %> </p>
            <p class="product_detail--type"> <%= item.catagory %> </p>
            <p class="product_detail--price"> $<%= item.price %>.99 </p>
            <span class="product_id" id="product_id_hash" _id = "<%= item._id %>" ></span>
            <% var inactive = item.quantity > 0 ? "" : "sold_out" %>
            <% var qty = item.quantity > 0 ? "Qty:"+item.quantity : "This Product is Currently Sold Out" %>

            <p class="product_detail--sold <%= inactive %>"><%= qty %></p>
            <br />
           <% if(!isAdmin) {%>
              <button product_id = "<%= item._id %>" class="detail_button"  id= "add_cart_button">Add to Cart</button>
            <%}else{%>
              <button _id = "<%= item._id %>" class="detail_button edit_button_p"  id= "edit_button_product">Edit</button>
            <%}%>
            <br />
            <p class="product_detail--description">
              <%= item.description %>
            </p>

        </div>


    </div>

    <div class="col-4">
      <% if (!isAdmin) {%>
        <img class="product_detail_image" src = <%= `./../${item.thumbnail}` %> />
      <%}else{%>
        <img class="product_detail_image" src = <%= `./../../../${item.thumbnail}` %> />
      <%}%>
    </div>

  </div>
  <button class="delete_perm"> Delete </button>
</main>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<% if(!isAdmin) {%>
  <script src = "./../js/search_results.js" ></script>
  <script src = "./../js/cart.js" ></script>
  <script src = "./../js/catagory_render.js" ></script>
  <script src = "./../js/util.js" ></script>

<% }else{%>
  <script src = "./../../../js/admin/edit_product.js" ></script>
  <script src = "./../../../js/util.js" ></script>
  <script>
      var delete_perm = document.querySelector(".delete_perm");
      var id_element = document.querySelector("#product_id_hash");

      delete_perm.addEventListener("click",(e)=>{

        var prompt_requirement = 'DELETE';
        var product_prompt = prompt( `Type ${prompt_requirement} to delete product (There is no way to add product back once deleted)`);

        if(product_prompt == prompt_requirement){
            var _id = id_element.getAttribute("_id");
            axios.post("/product/delete",_id).then((result)=>{
              console.log(result);
            }).catch((err)=>{console.log(err)});
        }else{
          alert("Canceled")
        }

      })

      ToggleEdit(true);
  </script>
<%}%>


<%- include("./../layouts/end.ejs") %>
